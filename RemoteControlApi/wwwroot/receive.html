<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Notifications</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Notifications</h1>
  <ul id="list"></ul>
  <script>
    const list = document.getElementById('list');
      function add(n) {
        if (n.message) n = n.message;
        const li = document.createElement('li');
        const title = n.title ?? n.Title ?? '';
        const body = n.body ?? n.Body ?? '';
        li.textContent = `${title}: ${body}`;
        const url = n.fileUrl ?? n.FileUrl;
        if (url) {
          const link = document.createElement('a');
          link.href = url;
          link.textContent = ' (file)';
          link.target = '_blank';
          li.appendChild(link);
        }
        list.prepend(li);
      }
    async function load() {
      const res = await fetch('/api/control/get-notifications');
      const json = await res.json();
      list.innerHTML = '';
      json.items.forEach(add);
    }
    load();
    const evt = new EventSource('/api/control/notifications-stream');
    evt.onmessage = e => add(JSON.parse(e.data));
  </script>
</body>
</html>
